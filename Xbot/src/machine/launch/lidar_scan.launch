<launch>
    <arg name = "use_rplidar_only" default = "false" />
    <arg name = "use_asus_only" default = "false" />
    <arg name = "fusion_data" default = "true" />


    <arg if="$(arg use_rplidar_only)" name="rplidar_topic" value="/scan" />
    <arg unless="$(arg use_rplidar_only)" name="rplidar_topic" value="/rplidar_scan" />

    <arg if="$(arg use_asus_only)" name="asus_topic" value="/scan" />
    <arg unless="$(arg use_asus_only)" name="asus_topic" value="/asus_scan" />

    <arg name="rplidar_frame" default="laser" />

    <node pkg="rplidar_python" type="rplidar_scan.py" name="rplidar" output="screen" respawn="true">
        <param name="frame_id" value="$(arg rplidar_frame)" />
        <param name="range_min" value="0.15"/>
        <param name="range_max" value="6.0"/>
        <param name="scan_topic" value="$(arg rplidar_topic)" />
    </node>

      <!-- Laserscan topic -->
    <arg name="scan_processing" default="true"/>
    <arg name="scan_height"      default="200"/>
    <!-- Factory-calibrated depth registration -->
    <arg name="camera"      default="camera"/>
    <!--Laserscan-->
    <group if="$(arg scan_processing)">
        <node pkg="nodelet" type="nodelet" name="depthimage_to_laserscan" args="load depthimage_to_laserscan/DepthImageToLaserScanNodelet $(arg camera)/$(arg camera)_nodelet_manager">
            <param name="scan_height" value="$(arg scan_height)" />
            <param name="output_frame_id" value="/$(arg camera)_depth_frame"/>
            <param name="range_min" value="0.2"/>
            <remap from="image" to="$(arg camera)/depth_registered/image_raw"/>
            <remap from="scan" to="$(arg asus_topic)"/>
            <remap from="$(arg camera)/image" to="$(arg camera)/depth_registered/image_raw"/>
            <remap from="$(arg camera)/scan" to="$(arg asus_topic)"/>
        </node>
    </group>

    <group if="$(arg fusion_data)">
        <include file="$(find nav_staff)/launch/xml/data_fusion.launch.xml">
            <arg name = 'use_rplidar_topic'      value = '/rplidar_scan' />
            <arg name = 'use_asus_topic'         value = '/asus_scan' />
            <arg name = 'scan_topic'             value = '/scan' />

            <arg name = 'target_frame'           value= 'laser' />
            <arg name = 'source_frame'           value= 'camera_depth_frame' />
            <arg name = 'fusion_data_frame'      value= 'global_scan' />

            <arg name = 'PublishFrequency'       value= '0.01' />
            <arg name = 'asus_max_range'         value= '3.5' />
        </include>
    </group>

</launch>
